Bootstrap: docker
From: nvidia/cudagl:9.2-devel-ubuntu18.04

%post
    # Install CUDNN
    export DEBIAN_FRONTEND=noninteractive
    apt-get update && apt-get install -y --no-install-recommends \
        libcudnn7=7.6.4.38 \
        libcudnn7-dev=7.6.4.38 \
    && \
        apt-mark hold libcudnn7 && \
        rm -rf /var/lib/apt/lists/*

    # Install additional libraries
    apt-get update && apt-get install -y wget doxygen curl libjsoncpp-dev libepoxy-dev libglm-dev libosmesa6 libosmesa6-dev libglew-dev libopencv-dev python-opencv python3-setuptools python3-dev python3-pip

    # Install Python packages
    pip3 install opencv-python==4.1.0.25 torch==1.1.0 torchvision==0.3.0 numpy==1.13.3 pandas==0.24.1 networkx==2.2

    # Install CMake
    wget https://cmake.org/files/v3.12/cmake-3.12.2-Linux-x86_64.sh -O /cmake-3.12.2-Linux-x86_64.sh
    mkdir /opt/cmake
    sh /cmake-3.12.2-Linux-x86_64.sh --prefix=/opt/cmake --skip-license
    ln -s /opt/cmake/bin/cmake /usr/local/bin/cmake
    cmake --version

%environment
    export PYTHONPATH=/root/mount/Matterport3DSimulator/build
